<!DOCTYPE html>
<html>
<head>
<title>BitFace Configuration</title>
  <!-- Include meta tag to ensure proper rendering and touch zooming -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
      <style type="text/css">
#footer {
width:100%;
height:auto;
position:absolute;
bottom:0;
left:0;
}
    </style>
    
  <!-- Include jQuery Mobile stylesheets -->
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
  <!-- Include the jQuery library -->
  <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
  <!-- Include the jQuery Mobile library -->
  <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
  

</head>
<body>

  <div data-role="page" id="pageone">
    <div data-role="header">
      <h1>BitFace Configuration</h1>
    </div>

    <div data-role="main" class="ui-content">
<!--       <p>Insert Content Here</p> -->

<!-- Invert Colours Switch  -->
      <div data-role="fieldcontain">
	<label for="invert-colours">Invert Colours :</label>
	<select name="invert-colours" id="invert-colours" data-role="slider">
	  <option value="off">Off</option>
	  <option value="on">On</option>
	</select>
      </div>

<!--       Date Formatter selector -->
      <fieldset class="ui-field-contain">
        <label for="date-format">Date Format :</label>
        <select name="date-format" id="date-format">
          <option value="dmyyyy">31/1/2015</option>
          <option value="ddmmyyyy">31/01/2015</option>
          <option value="dmmm">31 Jan</option>
          <option value="dmmmyyyy">31 Jan 2015</option>
          <option value="mmmd">Jan 31</option>
          <option value="mmmdyyyy">Jan 31 2015</option>
          <option value="mdyyyy">1/31/2015</option>
          <option value="mmddyyyy">01/31/2015</option>
        </select>
      </fieldset>
      
      <!--       Battery hide interval selector -->
      <fieldset class="ui-field-contain">
        <label for="battery-hide">Show battery for :</label>
        <select name="battery-hide" id="battery-hide">
          <option value="0">Do not show</option>
          <option value="1">1 second</option>
          <option value="2">2 seconds</option>
          <option value="5">5 seconds</option>
          <option value="10">10 seconds</option>
          <option value="15">15 seconds</option>
          <option value="30">30 seconds</option>
          <option value="-1">Do not hide</option>
        </select>
      </fieldset>
      
      
    </div>
    


<!--     <div data-role="footer"> -->
<!--       <h1>Insert Footer Text Here</h1> -->
<!--       <div id="footer"> -->
	<div class="ui-body ui-body-b">
          <fieldset class="ui-grid-a">
              <div class="ui-block-a"><div aria-disabled="false" class="ui-submit ui-btn ui-btn-up-d ui-shadow ui-btn-corner-all" data-disabled="false" data-theme="d" data-wrapperels="span" data-iconshadow="true" data-shadow="true" data-corners="true"><button data-disabled="false" class="ui-btn-hidden" type="submit" data-theme="d" id="b-cancel">Cancel</button></div></div>
              <div class="ui-block-b"><div aria-disabled="false" class="ui-submit ui-btn ui-shadow ui-btn-corner-all ui-btn-up-a" data-disabled="false" data-theme="a" data-wrapperels="span" data-iconshadow="true" data-shadow="true" data-corners="true"><button data-disabled="false" class="ui-btn-hidden" type="submit" data-theme="a" id="b-submit">Submit</button></div></div>
	  </fieldset>
        </div>
<!--         </div> -->
<!--     </div> -->
  </div> 

  <script>
    function saveOptions() {
      var options = {
	'invert-colours': $("#invert-colours").val(),
	'date-format': $("#date-format").val(),
	'battery-hide': $("#battery-hide").val()
      }
      return options;
    }
    
    function populateConfig() {
      var invertColours = getURLVariable('invert-colours');
      invertColours = decodeURI(invertColours);
      if (invertColours) {
	$('invert-colours').html(invertColours);
      }
      
      var dateFormat = getURLVariable('date-format');
      dateFormat = decodeURI(dateFormat);
      if (dateFormat) {
	$('date-format').html(dateFormat);
      }
      
      var batteryHide = getURLVariable('battery-hide');
      batteryHide = decodeURI(batteryHide);
      if (batteryHide) {
	$('battery-hide').html(batteryHide);
      }
      return;
    }

    $(document).ready(function() {

//     console.log("in ready function");
      populateConfig();
    
//     console.log("popluateConfig completed");
      
      $("#b-cancel").click(function() {
	document.location = "pebblejs://close";
      });
      
      $("#b-submit").click(function() {
	var location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(saveOptions()));
	document.location = location;
      });
    });

//    TODO: Need some proper method for this. Swictch to JSON for input to HTML
    function getURLVariable(name) {
      name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
      var regexS = "[\\?&]"+name+"=([^&#]*)",
	  regex = new RegExp(regexS),
	  results = regex.exec(window.location.href);
      if (results == null) return "";
      else return results[1];
    }
  </script>
    
</body>
</html>
